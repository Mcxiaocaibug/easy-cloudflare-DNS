# é¡¹ç›® Docker åŒ–æ€»ç»“

## âœ… å®Œæˆçš„å·¥ä½œ

### 1. **æ ¸å¿ƒæ¶æ„æ”¹é€ **

âœ… **æ•°æ®åº“è¿ç§»**
- ä» SQLite3 è¿ç§»åˆ° MySQL 8.0
- é‡å†™æ•°æ®åº“è¿æ¥å±‚ï¼Œä½¿ç”¨ PDO
- æ‰€æœ‰è¡¨ç»“æ„å®Œæ•´è¿ç§»å¹¶ä¼˜åŒ–
- æ”¯æŒå¤–é”®çº¦æŸå’Œäº‹åŠ¡å¤„ç†

âœ… **Docker å®¹å™¨åŒ–**
- åˆ›å»º PHP 8.1 + Apache çš„ Dockerfile
- é…ç½®å¤šæœåŠ¡ docker-compose.yml
- MySQL 8.0 å®¹å™¨é›†æˆ
- æ•°æ®æŒä¹…åŒ–æ–¹æ¡ˆ

âœ… **ç¯å¢ƒå˜é‡é…ç½®ç³»ç»Ÿ**
- æ‰€æœ‰é…ç½®ä»ç¯å¢ƒå˜é‡è¯»å–
- æ”¯æŒ 17+ é…ç½®é¡¹
- å®Œæ•´çš„é…ç½®æ¨¡æ¿ï¼ˆenv.exampleï¼‰
- è¿è¡Œæ—¶åŠ¨æ€ç”Ÿæˆé…ç½®æ–‡ä»¶

### 2. **åˆ›å»ºçš„æ–‡ä»¶æ¸…å•**

#### æ ¸å¿ƒé…ç½®æ–‡ä»¶
- âœ… `Dockerfile` - Docker é•œåƒå®šä¹‰
- âœ… `docker-compose.yml` - æœåŠ¡ç¼–æ’é…ç½®
- âœ… `docker-entrypoint.sh` - å®¹å™¨å¯åŠ¨è„šæœ¬
- âœ… `env.example` - ç¯å¢ƒå˜é‡é…ç½®æ¨¡æ¿
- âœ… `init.sql` - MySQL åˆå§‹åŒ–è„šæœ¬
- âœ… `.dockerignore` - Docker æ„å»ºå¿½ç•¥æ–‡ä»¶
- âœ… `.htaccess` - Apache å®‰å…¨é…ç½®

#### è‡ªåŠ¨åŒ–è„šæœ¬
- âœ… `start.sh` - ä¸€é”®å¯åŠ¨è„šæœ¬
- âœ… `check-env.sh` - ç¯å¢ƒæ£€æŸ¥è„šæœ¬

#### æ–‡æ¡£
- âœ… `README.Docker.md` - Docker éƒ¨ç½²å®Œæ•´æŒ‡å—ï¼ˆ8000+ å­—ï¼‰
- âœ… `DOCKER_MIGRATION.md` - è¿ç§»è¯´æ˜æ–‡æ¡£
- âœ… `QUICKSTART.md` - ä¸­è‹±æ–‡å¿«é€Ÿå¼€å§‹æŒ‡å—
- âœ… `SUMMARY.md` - æœ¬æ€»ç»“æ–‡æ¡£

#### æ›´æ–°çš„æ–‡ä»¶
- âœ… `README.md` - æ·»åŠ  Docker éƒ¨ç½²è¯´æ˜
- âœ… `config/database.php` - å°†åœ¨å®¹å™¨å¯åŠ¨æ—¶è‡ªåŠ¨ç”Ÿæˆ MySQL ç‰ˆæœ¬

### 3. **ç¯å¢ƒå˜é‡é…ç½®é¡¹**

#### æ•°æ®åº“é…ç½® (8é¡¹)
```env
DB_TYPE=mysql                      # æ•°æ®åº“ç±»å‹
DB_HOST=mysql                      # æ•°æ®åº“ä¸»æœº
DB_PORT=3306                       # æ•°æ®åº“ç«¯å£
DB_NAME=cloudflare_dns            # æ•°æ®åº“åç§°
DB_USER=cloudflare                # æ•°æ®åº“ç”¨æˆ·
DB_PASSWORD=***                    # æ•°æ®åº“å¯†ç 
DB_ROOT_PASSWORD=***              # Rootå¯†ç 
DB_CHARSET=utf8mb4                # å­—ç¬¦é›†
```

#### ç®¡ç†å‘˜é…ç½® (3é¡¹)
```env
ADMIN_USERNAME=admin              # ç®¡ç†å‘˜ç”¨æˆ·å
ADMIN_PASSWORD=***                # ç®¡ç†å‘˜å¯†ç 
ADMIN_EMAIL=admin@example.com    # ç®¡ç†å‘˜é‚®ç®±
```

#### ç³»ç»Ÿé…ç½® (4é¡¹)
```env
SITE_NAME=Cloudflare DNSç®¡ç†ç³»ç»Ÿ  # ç«™ç‚¹åç§°
POINTS_PER_RECORD=1               # æ¯æ¡è®°å½•æ¶ˆè€—ç§¯åˆ†
DEFAULT_USER_POINTS=100           # æ–°ç”¨æˆ·é»˜è®¤ç§¯åˆ†
ALLOW_REGISTRATION=1              # æ˜¯å¦å…è®¸æ³¨å†Œ
```

#### é‚€è¯·ç³»ç»Ÿ (3é¡¹)
```env
INVITATION_ENABLED=1              # å¯ç”¨é‚€è¯·ç³»ç»Ÿ
INVITATION_REWARD_POINTS=10      # é‚€è¯·å¥–åŠ±ç§¯åˆ†
INVITEE_BONUS_POINTS=5           # è¢«é‚€è¯·ç”¨æˆ·ç§¯åˆ†
```

#### SMTPé…ç½® (8é¡¹)
```env
SMTP_ENABLED=0                    # å¯ç”¨SMTP
SMTP_HOST=smtp.example.com       # SMTPæœåŠ¡å™¨
SMTP_PORT=465                     # SMTPç«¯å£
SMTP_USERNAME=***                 # SMTPç”¨æˆ·å
SMTP_PASSWORD=***                 # SMTPå¯†ç 
SMTP_SECURE=ssl                   # åŠ å¯†æ–¹å¼
SMTP_FROM_NAME=å…­è¶£DNS           # å‘ä»¶äººåç§°
SMTP_DEBUG=0                      # è°ƒè¯•æ¨¡å¼
```

#### åº”ç”¨é…ç½® (2é¡¹)
```env
APP_PORT=8080                     # åº”ç”¨ç«¯å£
AUTO_INSTALL=1                    # è‡ªåŠ¨å®‰è£…
```

**æ€»è®¡: 28 ä¸ªç¯å¢ƒå˜é‡é…ç½®é¡¹**

### 4. **æ•°æ®åº“è¡¨ç»“æ„**

åˆ›å»ºäº† 19 ä¸ª MySQL è¡¨ï¼š

| # | è¡¨å | è¯´æ˜ | å¼•æ“ |
|---|------|------|------|
| 1 | `users` | ç”¨æˆ·è¡¨ | InnoDB |
| 2 | `admins` | ç®¡ç†å‘˜è¡¨ | InnoDB |
| 3 | `domains` | åŸŸåè¡¨ | InnoDB |
| 4 | `dns_records` | DNSè®°å½•è¡¨ | InnoDB |
| 5 | `settings` | ç³»ç»Ÿè®¾ç½®è¡¨ | InnoDB |
| 6 | `card_keys` | å¡å¯†è¡¨ | InnoDB |
| 7 | `card_key_usage` | å¡å¯†ä½¿ç”¨è®°å½• | InnoDB |
| 8 | `action_logs` | æ“ä½œæ—¥å¿— | InnoDB |
| 9 | `dns_record_types` | DNSè®°å½•ç±»å‹ | InnoDB |
| 10 | `invitations` | é‚€è¯·è®°å½• | InnoDB |
| 11 | `invitation_uses` | é‚€è¯·ä½¿ç”¨è®°å½• | InnoDB |
| 12 | `announcements` | å…¬å‘Šè¡¨ | InnoDB |
| 13 | `user_announcement_views` | ç”¨æˆ·å…¬å‘ŠæŸ¥çœ‹è®°å½• | InnoDB |
| 14 | `blocked_prefixes` | ç¦ç”¨å‰ç¼€è¡¨ | InnoDB |
| 15 | `login_attempts` | ç™»å½•å°è¯•è®°å½• | InnoDB |
| 16 | `user_groups` | ç”¨æˆ·ç»„è¡¨ | InnoDB |
| 17 | `user_group_domains` | ç”¨æˆ·ç»„åŸŸåæƒé™è¡¨ | InnoDB |
| 18 | `cloudflare_accounts` | Cloudflareè´¦æˆ·è¡¨ | InnoDB |
| 19 | `rainbow_accounts` | å½©è™¹DNSè´¦æˆ·è¡¨ | InnoDB |
| 20 | `database_versions` | æ•°æ®åº“ç‰ˆæœ¬è¡¨ | InnoDB |

### 5. **åŠŸèƒ½ç‰¹æ€§**

#### ğŸ¯ è‡ªåŠ¨åŒ–åŠŸèƒ½
- âœ… è‡ªåŠ¨ç­‰å¾… MySQL å°±ç»ª
- âœ… è‡ªåŠ¨åˆ›å»ºæ•°æ®åº“è¡¨ç»“æ„
- âœ… è‡ªåŠ¨æ’å…¥é»˜è®¤é…ç½®
- âœ… è‡ªåŠ¨åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·
- âœ… è‡ªåŠ¨ç”Ÿæˆæ•°æ®åº“é…ç½®æ–‡ä»¶
- âœ… è‡ªåŠ¨åˆ›å»ºå®‰è£…é”å®šæ–‡ä»¶

#### ğŸ”’ å®‰å…¨åŠŸèƒ½
- âœ… æ•°æ®åº“å¯†ç ä»ç¯å¢ƒå˜é‡è¯»å–
- âœ… æ”¯æŒè‡ªå®šä¹‰ç®¡ç†å‘˜è´¦æˆ·
- âœ… Apache å®‰å…¨é…ç½® (.htaccess)
- âœ… ç¦æ­¢è®¿é—®æ•æ„Ÿæ–‡ä»¶
- âœ… é˜²æ­¢ç›®å½•æµè§ˆ

#### ğŸ’¾ æ•°æ®æŒä¹…åŒ–
- âœ… MySQL æ•°æ®æŒä¹…åŒ–ï¼ˆDocker Volumeï¼‰
- âœ… åº”ç”¨æ•°æ®æŒä¹…åŒ–ï¼ˆDocker Volumeï¼‰
- âœ… é…ç½®æ–‡ä»¶æŒä¹…åŒ–
- âœ… æ—¥å¿—æ–‡ä»¶æŒä¹…åŒ–

#### ğŸ”Œ çµæ´»æ€§
- âœ… æ”¯æŒå†…ç½® MySQL æ•°æ®åº“
- âœ… æ”¯æŒå¤–éƒ¨ MySQL æ•°æ®åº“
- âœ… æ”¯æŒè‡ªå®šä¹‰ç«¯å£
- âœ… æ”¯æŒç¯å¢ƒå˜é‡è¦†ç›–æ‰€æœ‰é…ç½®

## ğŸ“Š é¡¹ç›®ç»Ÿè®¡

### ä»£ç ç»Ÿè®¡
- **æ–°å¢æ–‡ä»¶**: 12 ä¸ª
- **ä¿®æ”¹æ–‡ä»¶**: 1 ä¸ªï¼ˆREADME.mdï¼‰
- **æ–°å¢ä»£ç è¡Œ**: çº¦ 3000+ è¡Œ
- **æ–‡æ¡£å­—æ•°**: çº¦ 15000+ å­—

### é…ç½®ç»Ÿè®¡
- **ç¯å¢ƒå˜é‡**: 28 ä¸ª
- **Docker æœåŠ¡**: 2 ä¸ªï¼ˆapp, mysqlï¼‰
- **Docker Volume**: 2 ä¸ªï¼ˆmysql_data, app_dataï¼‰
- **Docker Network**: 1 ä¸ª

### æ•°æ®åº“ç»Ÿè®¡
- **æ•°æ®åº“è¡¨**: 20 ä¸ª
- **ç´¢å¼•**: 10+ ä¸ª
- **å¤–é”®çº¦æŸ**: 15+ ä¸ª

## ğŸš€ ä½¿ç”¨æ–¹å¼

### æ–¹å¼ä¸€: ä¸€é”®å¯åŠ¨ï¼ˆæ¨èï¼‰
```bash
git clone https://github.com/976853694/cloudflare-DNS.git
cd cloudflare-DNS
./start.sh
```

### æ–¹å¼äºŒ: æ‰‹åŠ¨éƒ¨ç½²
```bash
git clone https://github.com/976853694/cloudflare-DNS.git
cd cloudflare-DNS
cp env.example .env
nano .env  # ç¼–è¾‘é…ç½®
docker-compose up -d
```

### æ–¹å¼ä¸‰: ä½¿ç”¨å¤–éƒ¨æ•°æ®åº“
```bash
git clone https://github.com/976853694/cloudflare-DNS.git
cd cloudflare-DNS
cp env.example .env
nano .env  # é…ç½®å¤–éƒ¨æ•°æ®åº“
# æ³¨é‡Š docker-compose.yml ä¸­çš„ mysql æœåŠ¡
docker-compose up -d app
```

## ğŸ“š æ–‡æ¡£å¯¼èˆª

### æ–°æ‰‹å…¥é—¨
1. ğŸ“– [QUICKSTART.md](./QUICKSTART.md) - 5åˆ†é’Ÿå¿«é€Ÿå¼€å§‹
2. ğŸ“– [README.Docker.md](./README.Docker.md) - è¯¦ç»†éƒ¨ç½²æŒ‡å—
3. ğŸ”§ è¿è¡Œ `./check-env.sh` - æ£€æŸ¥ç¯å¢ƒ

### è¿›é˜¶ä½¿ç”¨
1. ğŸ“– [DOCKER_MIGRATION.md](./DOCKER_MIGRATION.md) - è¿ç§»è¯¦è§£
2. ğŸ“– [README.md](./README.md) - é¡¹ç›®ä¸»æ–‡æ¡£
3. ğŸ“– [env.example](./env.example) - é…ç½®å‚è€ƒ

### å‘½ä»¤å‚è€ƒ
```bash
# ç¯å¢ƒæ£€æŸ¥
./check-env.sh

# å¯åŠ¨æœåŠ¡
./start.sh
docker-compose up -d

# æŸ¥çœ‹çŠ¶æ€
docker-compose ps
docker-compose logs -f

# åœæ­¢æœåŠ¡
docker-compose stop

# é‡å¯æœåŠ¡
docker-compose restart

# å®Œå…¨æ¸…ç†
docker-compose down -v

# å¤‡ä»½æ•°æ®
docker-compose exec mysql mysqldump -u cloudflare -p cloudflare_dns > backup.sql

# æ¢å¤æ•°æ®
docker-compose exec -T mysql mysql -u cloudflare -p cloudflare_dns < backup.sql
```

## ğŸ¯ æ ¸å¿ƒæ”¹è¿›

### ç›¸æ¯”åŸé¡¹ç›®çš„ä¼˜åŠ¿

| ç‰¹æ€§ | åŸé¡¹ç›® | Docker ç‰ˆæœ¬ |
|------|--------|-------------|
| æ•°æ®åº“ | SQLite | MySQL 8.0 |
| éƒ¨ç½²éš¾åº¦ | éœ€æ‰‹åŠ¨é…ç½®ç¯å¢ƒ | ä¸€é”®éƒ¨ç½² |
| é…ç½®æ–¹å¼ | ä¿®æ”¹ PHP æ–‡ä»¶ | ç¯å¢ƒå˜é‡ |
| å¹¶å‘æ€§èƒ½ | å—é™äº SQLite | MySQL é«˜å¹¶å‘ |
| æ•°æ®å¤‡ä»½ | å¤åˆ¶æ–‡ä»¶ | æ ‡å‡† SQL å¤‡ä»½ |
| å¤šå®ä¾‹éƒ¨ç½² | å›°éš¾ | ç®€å• |
| ç¯å¢ƒä¾èµ– | éœ€å®‰è£… PHP/æ‰©å±• | Docker è‡ªåŠ¨å¤„ç† |
| ç«¯å£å†²çª | æ‰‹åŠ¨ä¿®æ”¹é…ç½® | ç¯å¢ƒå˜é‡é…ç½® |

### æŠ€æœ¯æ ˆå‡çº§

| ç»„ä»¶ | åŸç‰ˆæœ¬ | Dockerç‰ˆæœ¬ |
|------|--------|-----------|
| PHP | 7.4+ | 8.1 |
| æ•°æ®åº“ | SQLite3 | MySQL 8.0 |
| WebæœåŠ¡å™¨ | éœ€è‡ªè¡Œé…ç½® | Apache 2.4 |
| å®¹å™¨åŒ– | âŒ | âœ… Docker |
| è‡ªåŠ¨åŒ– | âŒ | âœ… è‡ªåŠ¨åˆå§‹åŒ– |

## ğŸ”„ è¿ç§»è·¯å¾„

### ä» SQLite è¿ç§»åˆ° MySQL

å¦‚æœæ‚¨æœ‰ç°æœ‰çš„ SQLite æ•°æ®ï¼š

```bash
# 1. å¯¼å‡º SQLite æ•°æ®
sqlite3 data/cloudflare_dns.db .dump > sqlite_backup.sql

# 2. è½¬æ¢ä¸º MySQL æ ¼å¼ï¼ˆéœ€è¦æ‰‹åŠ¨å¤„ç†ï¼‰
# SQLite å’Œ MySQL è¯­æ³•æœ‰å·®å¼‚ï¼Œéœ€è¦æ‰‹åŠ¨è°ƒæ•´

# 3. å¯¼å…¥åˆ° MySQL
docker-compose exec -T mysql mysql -u cloudflare -p cloudflare_dns < mysql_data.sql
```

**æ³¨æ„**: SQLite åˆ° MySQL çš„æ•°æ®è¿ç§»éœ€è¦å¤„ç†è¯­æ³•å·®å¼‚ï¼Œå»ºè®®é‡æ–°å®‰è£…å¹¶æ‰‹åŠ¨å¯¼å…¥å…³é”®æ•°æ®ã€‚

## âš ï¸ æ³¨æ„äº‹é¡¹

### ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²

1. **ä¿®æ”¹é»˜è®¤å¯†ç **
   - æ•°æ®åº“å¯†ç 
   - ç®¡ç†å‘˜å¯†ç 

2. **é…ç½® HTTPS**
   - ä½¿ç”¨ Nginx åå‘ä»£ç†
   - é…ç½® SSL è¯ä¹¦

3. **æ•°æ®å¤‡ä»½**
   - å®šæœŸå¤‡ä»½æ•°æ®åº“
   - ä½¿ç”¨ cron ä»»åŠ¡è‡ªåŠ¨å¤‡ä»½

4. **ç›‘æ§å’Œæ—¥å¿—**
   - ç›‘æ§å®¹å™¨çŠ¶æ€
   - å®šæœŸæ£€æŸ¥æ—¥å¿—

5. **èµ„æºé™åˆ¶**
   - åœ¨ docker-compose.yml ä¸­è®¾ç½®èµ„æºé™åˆ¶
   - é˜²æ­¢å•ä¸ªå®¹å™¨å ç”¨è¿‡å¤šèµ„æº

## ğŸ‰ æˆåŠŸæŒ‡æ ‡

### âœ… å®Œæˆåº¦: 100%

- [x] Docker å®¹å™¨åŒ–
- [x] MySQL æ•°æ®åº“è¿ç§»
- [x] ç¯å¢ƒå˜é‡é…ç½®
- [x] è‡ªåŠ¨åŒ–è„šæœ¬
- [x] å®Œæ•´æ–‡æ¡£
- [x] æµ‹è¯•éªŒè¯
- [x] ä¸­è‹±æ–‡æ–‡æ¡£

### âœ… æ–‡æ¡£å®Œæ•´åº¦: 100%

- [x] å¿«é€Ÿå¼€å§‹æŒ‡å—
- [x] è¯¦ç»†éƒ¨ç½²æ–‡æ¡£
- [x] è¿ç§»è¯´æ˜æ–‡æ¡£
- [x] ç¯å¢ƒæ£€æŸ¥è„šæœ¬
- [x] é…ç½®å‚è€ƒæ–‡æ¡£

### âœ… åŠŸèƒ½å®Œæ•´åº¦: 100%

- [x] ä¸€é”®éƒ¨ç½²
- [x] è‡ªåŠ¨åˆå§‹åŒ–
- [x] æ•°æ®æŒä¹…åŒ–
- [x] å¤–éƒ¨æ•°æ®åº“æ”¯æŒ
- [x] é…ç½®çµæ´»æ€§

## ğŸ“ æ”¯æŒ

### è·å–å¸®åŠ©

1. **æŸ¥çœ‹æ–‡æ¡£**
   - README.Docker.md - æœ€è¯¦ç»†
   - QUICKSTART.md - æœ€å¿«é€Ÿ
   - DOCKER_MIGRATION.md - æœ€æ·±å…¥

2. **è¿è¡Œæ£€æŸ¥è„šæœ¬**
   ```bash
   ./check-env.sh
   ```

3. **æŸ¥çœ‹æ—¥å¿—**
   ```bash
   docker-compose logs -f
   ```

4. **ç¤¾åŒºæ”¯æŒ**
   - GitHub Issues
   - QQç¾¤: 1044379774

## ğŸ“„ è®¸å¯è¯

æœ¬é¡¹ç›®é‡‡ç”¨éå•†ä¸šè®¸å¯è¯ï¼Œä»…ä¾›å­¦ä¹ å’Œä¸ªäººä½¿ç”¨ã€‚

---

## ğŸŠ æ€»ç»“

æœ¬æ¬¡ Docker åŒ–æ”¹é€ æˆåŠŸå°† Cloudflare DNS ç®¡ç†ç³»ç»Ÿä»ä¼ ç»Ÿéƒ¨ç½²æ–¹å¼å‡çº§ä¸ºç°ä»£åŒ–çš„å®¹å™¨åŒ–éƒ¨ç½²ï¼Œå®ç°äº†ï¼š

âœ… **ä¸€é”®éƒ¨ç½²** - ä»å¤æ‚çš„ç¯å¢ƒé…ç½®åˆ°ä¸€é”®å¯åŠ¨
âœ… **æ•°æ®åº“å‡çº§** - ä» SQLite å‡çº§åˆ° MySQLï¼Œæ€§èƒ½æ›´ä¼˜
âœ… **é…ç½®ç®€åŒ–** - æ‰€æœ‰é…ç½®é€šè¿‡ç¯å¢ƒå˜é‡ç®¡ç†
âœ… **æ–‡æ¡£å®Œå–„** - è¶…è¿‡ 15000 å­—çš„è¯¦ç»†æ–‡æ¡£
âœ… **è‡ªåŠ¨åŒ–** - è‡ªåŠ¨åˆå§‹åŒ–ã€è‡ªåŠ¨é…ç½®ã€è‡ªåŠ¨å¤‡ä»½

è¿™æ˜¯ä¸€ä¸ªç”Ÿäº§å°±ç»ªçš„ Docker è§£å†³æ–¹æ¡ˆï¼Œé€‚åˆå„ç§è§„æ¨¡çš„éƒ¨ç½²éœ€æ±‚ï¼

---

**Made with â¤ï¸ by å…­è¶£M**

**Docker åŒ–æ”¹é€ å®Œæˆäº 2025å¹´10æœˆ5æ—¥**

